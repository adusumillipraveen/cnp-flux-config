---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: neuvector
  namespace: neuvector
spec:
  values:
    autoScan: true
    rules:
      admission:
        rules:
          - '{"config":{"id":1000,"category":"Kubernetes","comment":"Allow system namespaces","criteria":[{"name":"namespace","op":"containsAny","value":"neuvector,kube-system,knode-system"}],"disable":false,"rule_type": "exception","cfg_type":"user_created"}}'
          - '{"config":{"id":1001,"category":"Kubernetes","comment":"Allow admin namespaces","criteria":[{"name":"namespace","op":"containsAny","value":"admin,kured,monitoring"}],"disable":false,"rule_type": "exception","cfg_type":"user_created"}}'
          - '{"config":{"id":1002,"category":"Kubernetes","comment":"Allow HMCTS registries","criteria":[{"name":"imageRegistry","op":"containsAny","value":"https://hmctspublic.azurecr.io/,https://hmctsprivate.azurecr.io/"}],"disable":false,"rule_type": "exception","cfg_type":"user_created"}}'
          - '{"config":{"id":1003,"category":"Kubernetes","comment":"Allow Flux v2 registry","criteria":[{"name":"imageRegistry","op":"containsAny","value":"https://ghcr.io/fluxcd/"}],"disable":false,"rule_type": "exception","cfg_type":"user_created"}}'
          - '{"config":{"id":1004,"category":"Kubernetes","comment":"Default deny","criteria":[{"name":"imageRegistry","op":"containsAny","value":"https://localhost/,https://*.*/"}],"disable":false,"rule_type": "deny","cfg_type":"user_created"}}'
    neuvector:
      tag: 4.4.2
      cve:
        scanner:
          image:
            repository: neuvector/scanner
          replicas: 2
    keyvault:
      name: cftapps
      resourcegroup: core-infra-ithc-rg
      subscriptionid: 62864d44-5da9-4ae9-89e7-0cf33942fa09
      tenantid: 531ff96d-0ae9-462a-8d2d-bec7c0b42082
      aadpodidbinding: neuvector
      licensesecretname: neuvector-license-dev
    keyVaults:
      cftapps:
        secrets:
          - neuvector-admin-password
          - neuvector-license-dev
          - neuvector-slack-webhook
          - neuvector-new-admin-password
  chart:
    spec:
      version: 1.2.5
